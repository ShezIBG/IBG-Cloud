<ng-container *ngIf="list">
	<div class="card-box">
		<div class="row">
			<div class="col-sm-3 col-lg-2">
				<div class="form-group">
					<label>Rack</label>
					<input class="form-control" [(ngModel)]="newLocation.rack">
				</div>
			</div>
			<div class="col-sm-3 col-lg-2">
				<div class="form-group">
					<label>Bay</label>
					<input class="form-control" [(ngModel)]="newLocation.bay">
				</div>
			</div>
			<div class="col-sm-3 col-lg-2">
				<div class="form-group">
					<label>Level</label>
					<input class="form-control" [(ngModel)]="newLocation.level">
				</div>
			</div>
			<div class="col-sm-2 col-lg-1">
				<div class="form-group">
					<label>Delimiter</label>
					<input class="form-control" [(ngModel)]="newLocation.delim">
				</div>
			</div>
		</div>
		<p class="text-info"><i class="md md-info"></i> <b>Rack</b> must be filled in, all other fields are optional. To create multiple locations, you can enter comma separated values and/or numeric or single-character ranges (e.g. <b>LOC1, LOC2, 5-10, A-Z</b>). Descriptions will be generated by concatenating the values with the <b>delimiter</b>. For example rack 1 bay A level 2 with delimiter '/' will be: '1/A/2'</p>
		<button class="btn btn-primary" (click)="createLocation()"><i class="md md-add"></i> Create stock location</button>
	</div>

	<div *ngIf="list" class="card-box">
		<table class="table table-hover vam">
			<thead>
				<tr>
					<th class="shrink nowrap"></th>
					<th class="shrink nowrap" colspan="3">Depth</th>
					<th class="shrink nowrap">Contains</th>
					<th class="td-sep shrink nowrap">Label</th>
					<th class="td-sep">Description</th>
					<th></th>
					<th class="shrink nowrap"></th>
					<th class="shrink nowrap"></th>
				</tr>
			</thead>
			<tbody>
				<ng-template #locationItem let-item>
					<td class="shrink nowrap" [ngClass]="{ clickable: item.bays.length || item.levels.length }" (click)="toggleItem(item)">
						<span *ngIf="item.bays.length" class="subtitle">({{item.bays.length}} {{item.bays.length === 1 ? 'bay' : 'bays'}})</span>
						<span *ngIf="item.levels.length" class="subtitle">({{item.levels.length}} {{item.levels.length === 1 ? 'level' : 'levels'}})</span>
					</td>
					<td class="td-sep shrink nowrap text-large">
						<i class="eticon eticon-arrow-up clickable" [ngClass]="{ 'text-primary': hasLabel(item, 'up'), 'label-off': !hasLabel(item, 'up') }" (click)="setLabel(item, 'up')"></i>
						<i class="eticon eticon-arrow-down clickable" [ngClass]="{ 'text-primary': hasLabel(item, 'down'), 'label-off': !hasLabel(item, 'down') }" (click)="setLabel(item, 'down')"></i>
					</td>
					<td class="td-sep">{{item.description}}</td>
					<td><span class="subtitle">{{item.product_count ? (item.product_count + (item.product_count === 1 ? ' product' : ' products')) : ''}}</span></td>
					<td class="shrink nowrap">
						<a *ngIf="!item.level" (click)="printLocation(item)"><i class="md md-print"></i> Print labels</a>
					</td>
					<td class="shrink nowrap">
						<a *ngIf="item.id" class="text-danger" (click)="deleteLocation(item)"><i class="md md-delete"></i> Delete</a>
					</td>
				</ng-template>

				<ng-container *ngFor="let rack of racks">
					<tr class="info">
						<td class="shrink nowrap">
							<ng-container *ngIf="rack.bays.length || rack.levels.length">
								<i *ngIf="!isExpanded(rack)" class="fa fa-fw fa-caret-right"></i>
								<i *ngIf="isExpanded(rack)" class="fa fa-fw fa-caret-down"></i>
							</ng-container>
						</td>
						<td class="shrink nowrap" [ngClass]="{ clickable: rack.bays.length || rack.levels.length }" (click)="toggleItem(rack)">Rack {{rack.rack}}</td>
						<td class="shrink nowrap" [ngClass]="{ clickable: rack.bays.length || rack.levels.length }" (click)="toggleItem(rack)"></td>
						<td class="shrink nowrap" [ngClass]="{ clickable: rack.bays.length || rack.levels.length }" (click)="toggleItem(rack)"></td>
						<ng-container *ngTemplateOutlet="locationItem;context:{$implicit:rack}"></ng-container>
					</tr>

					<ng-container *ngIf="isExpanded(rack)">
						<ng-container *ngFor="let bay of rack.bays">
							<tr class="warning">
								<td class="shrink nowrap">
									<ng-container *ngIf="bay.levels.length">
										<i *ngIf="!isExpanded(bay)" class="fa fa-fw fa-caret-right"></i>
										<i *ngIf="isExpanded(bay)" class="fa fa-fw fa-caret-down"></i>
									</ng-container>
								</td>
								<td class="shrink nowrap" [ngClass]="{ clickable: bay.levels.length }" (click)="toggleItem(bay)"><span class="subtitle">Rack {{bay.rack}}</span></td>
								<td class="shrink nowrap" [ngClass]="{ clickable: bay.levels.length }" (click)="toggleItem(bay)">Bay {{bay.bay}}</td>
								<td class="shrink nowrap" [ngClass]="{ clickable: bay.levels.length }" (click)="toggleItem(bay)"></td>
								<ng-container *ngTemplateOutlet="locationItem;context:{$implicit:bay}"></ng-container>
							</tr>

							<ng-container *ngIf="isExpanded(bay)">
								<ng-container *ngFor="let level of bay.levels">
									<tr>
										<td class="shrink nowrap"></td>
										<td class="shrink nowrap"><span class="subtitle">Rack {{level.rack}}</span></td>
										<td class="shrink nowrap"><span *ngIf="level.bay" class="subtitle">Bay {{level.bay}}</span></td>
										<td class="shrink nowrap">Level {{level.level}}</td>
										<ng-container *ngTemplateOutlet="locationItem;context:{$implicit:level}"></ng-container>
									</tr>
								</ng-container>
							</ng-container>

						</ng-container>

						<ng-container *ngFor="let level of rack.levels">
							<tr>
								<td class="shrink nowrap"></td>
								<td class="shrink nowrap"><span class="subtitle">Rack {{level.rack}}</span></td>
								<td class="shrink nowrap">Level {{level.level}}</td>
								<td class="shrink nowrap"></td>
								<ng-container *ngTemplateOutlet="locationItem;context:{$implicit:level}"></ng-container>
							</tr>
						</ng-container>
					</ng-container>
				</ng-container>
				<tr *ngIf="!racks.length">
					<td colspan="8">No stock locations found.</td>
				</tr>
			</tbody>
		</table>
	</div>
</ng-container>
